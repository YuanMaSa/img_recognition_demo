{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FacebookButton = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nexports.default = withFacebook;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AmplifyUITheme = require('../../Amplify-UI/Amplify-UI-Theme');\n\nvar _AmplifyUITheme2 = _interopRequireDefault(_AmplifyUITheme);\n\nvar _ui = require('@aws-amplify/ui');\n\nvar _AmplifyUIComponentsReact = require('../../Amplify-UI/Amplify-UI-Components-React');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar logger = new _core.ConsoleLogger('withFacebook');\n\nfunction withFacebook(Comp) {\n  return function (_Component) {\n    (0, _inherits3.default)(_class, _Component);\n\n    function _class(props) {\n      (0, _classCallCheck3.default)(this, _class);\n\n      var _this = (0, _possibleConstructorReturn3.default)(this, (_class.__proto__ || Object.getPrototypeOf(_class)).call(this, props));\n\n      _this.fbAsyncInit = _this.fbAsyncInit.bind(_this);\n      _this.initFB = _this.initFB.bind(_this);\n      _this.signIn = _this.signIn.bind(_this);\n      _this.federatedSignIn = _this.federatedSignIn.bind(_this);\n      _this.state = {};\n      return _this;\n    }\n\n    (0, _createClass3.default)(_class, [{\n      key: 'signIn',\n      value: function signIn() {\n        var _this2 = this;\n\n        var fb = window.FB;\n        fb.getLoginStatus(function (response) {\n          if (response.status === 'connected') {\n            _this2.federatedSignIn(response.authResponse);\n          } else {\n            fb.login(function (response) {\n              if (!response || !response.authResponse) {\n                return;\n              }\n\n              _this2.federatedSignIn(response.authResponse);\n            }, {\n              scope: 'public_profile,email'\n            });\n          }\n        });\n      }\n    }, {\n      key: 'federatedSignIn',\n      value: function federatedSignIn(response) {\n        logger.debug(response);\n        var onStateChange = this.props.onStateChange;\n        var accessToken = response.accessToken,\n            expiresIn = response.expiresIn;\n        var date = new Date();\n        var expires_at = expiresIn * 1000 + date.getTime();\n\n        if (!accessToken) {\n          return;\n        }\n\n        var fb = window.FB;\n        fb.api('/me', function (response) {\n          var user = {\n            name: response.name\n          };\n\n          if (!_auth2.default || typeof _auth2.default.federatedSignIn !== 'function' || typeof _auth2.default.currentAuthenticatedUser !== 'function') {\n            throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n          }\n\n          _auth2.default.federatedSignIn('facebook', {\n            token: accessToken,\n            expires_at: expires_at\n          }, user).then(function (credentials) {\n            return _auth2.default.currentAuthenticatedUser();\n          }).then(function (authUser) {\n            if (onStateChange) {\n              onStateChange('signedIn', authUser);\n            }\n          });\n        });\n      }\n    }, {\n      key: 'componentDidMount',\n      value: function componentDidMount() {\n        var facebook_app_id = this.props.facebook_app_id;\n        if (facebook_app_id) this.createScript();\n      }\n    }, {\n      key: 'fbAsyncInit',\n      value: function fbAsyncInit() {\n        logger.debug('init FB');\n        var facebook_app_id = this.props.facebook_app_id;\n        var fb = window.FB;\n        fb.init({\n          appId: facebook_app_id,\n          cookie: true,\n          xfbml: true,\n          version: 'v2.11'\n        });\n        fb.getLoginStatus(function (response) {\n          return logger.debug(response);\n        });\n      }\n    }, {\n      key: 'initFB',\n      value: function initFB() {\n        var fb = window.FB;\n        logger.debug('FB inited');\n      }\n    }, {\n      key: 'createScript',\n      value: function createScript() {\n        window.fbAsyncInit = this.fbAsyncInit;\n        var script = document.createElement('script');\n        script.src = 'https://connect.facebook.net/en_US/sdk.js';\n        script.async = true;\n        script.onload = this.initFB;\n        document.body.appendChild(script);\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        var fb = window.FB;\n        return _react2.default.createElement(Comp, (0, _extends3.default)({}, this.props, {\n          fb: fb,\n          facebookSignIn: this.signIn\n        }));\n      }\n    }]);\n    return _class;\n  }(_react.Component);\n}\n\nvar Button = function Button(props) {\n  return _react2.default.createElement(_AmplifyUIComponentsReact.SignInButton, {\n    id: _ui.facebookSignInButton,\n    onClick: props.facebookSignIn,\n    theme: props.theme || _AmplifyUITheme2.default,\n    variant: 'facebookSignInButton'\n  }, _react2.default.createElement(_AmplifyUIComponentsReact.SignInButtonIcon, {\n    theme: props.theme || _AmplifyUITheme2.default\n  }, _react2.default.createElement('svg', {\n    viewBox: '0 0 279 538',\n    xmlns: 'http://www.w3.org/2000/svg'\n  }, _react2.default.createElement('g', {\n    id: 'Page-1',\n    fill: 'none',\n    fillRule: 'evenodd'\n  }, _react2.default.createElement('g', {\n    id: 'Artboard',\n    fill: '#FFF'\n  }, _react2.default.createElement('path', {\n    d: 'M82.3409742,538 L82.3409742,292.936652 L0,292.936652 L0,196.990154 L82.2410458,196.990154 L82.2410458,126.4295 C82.2410458,44.575144 132.205229,0 205.252865,0 C240.227794,0 270.306232,2.59855099 279,3.79788222 L279,89.2502322 L228.536175,89.2502322 C188.964542,89.2502322 181.270057,108.139699 181.270057,135.824262 L181.270057,196.89021 L276.202006,196.89021 L263.810888,292.836708 L181.16913,292.836708 L181.16913,538 L82.3409742,538 Z',\n    id: 'Fill-1'\n  }))))), _react2.default.createElement(_AmplifyUIComponentsReact.SignInButtonContent, {\n    theme: props.theme || _AmplifyUITheme2.default\n  }, _core.I18n.get('Sign In with Facebook')));\n};\n\nvar FacebookButton = exports.FacebookButton = withFacebook(Button);","map":null,"metadata":{},"sourceType":"script"}