{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GoogleButton = undefined;\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nexports.default = withGoogle;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AmplifyUITheme = require('../../Amplify-UI/Amplify-UI-Theme');\n\nvar _AmplifyUITheme2 = _interopRequireDefault(_AmplifyUITheme);\n\nvar _ui = require('@aws-amplify/ui');\n\nvar _AmplifyUIComponentsReact = require('../../Amplify-UI/Amplify-UI-Components-React');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar logger = new _core.ConsoleLogger('withGoogle');\n\nfunction withGoogle(Comp) {\n  return function (_Component) {\n    (0, _inherits3.default)(_class, _Component);\n\n    function _class(props) {\n      (0, _classCallCheck3.default)(this, _class);\n\n      var _this = (0, _possibleConstructorReturn3.default)(this, (_class.__proto__ || Object.getPrototypeOf(_class)).call(this, props));\n\n      _this.initGapi = _this.initGapi.bind(_this);\n      _this.signIn = _this.signIn.bind(_this);\n      _this.federatedSignIn = _this.federatedSignIn.bind(_this);\n      _this.state = {};\n      return _this;\n    }\n\n    (0, _createClass3.default)(_class, [{\n      key: 'signIn',\n      value: function signIn() {\n        var _this2 = this;\n\n        var ga = window.gapi.auth2.getAuthInstance();\n        var onError = this.props.onError;\n        ga.signIn().then(function (googleUser) {\n          return _this2.federatedSignIn(googleUser);\n        }, function (error) {\n          if (onError) onError(error);else throw error;\n        });\n      }\n    }, {\n      key: 'federatedSignIn',\n      value: function () {\n        var _ref = (0, _asyncToGenerator3.default)(\n        /*#__PURE__*/\n        _regenerator2.default.mark(function _callee(googleUser) {\n          var _googleUser$getAuthRe, id_token, expires_at, profile, user, onStateChange;\n\n          return _regenerator2.default.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _googleUser$getAuthRe = googleUser.getAuthResponse(), id_token = _googleUser$getAuthRe.id_token, expires_at = _googleUser$getAuthRe.expires_at;\n                  profile = googleUser.getBasicProfile();\n                  user = {\n                    email: profile.getEmail(),\n                    name: profile.getName()\n                  };\n                  onStateChange = this.props.onStateChange;\n\n                  if (!(!_auth2.default || typeof _auth2.default.federatedSignIn !== 'function' || typeof _auth2.default.currentAuthenticatedUser !== 'function')) {\n                    _context.next = 6;\n                    break;\n                  }\n\n                  throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n\n                case 6:\n                  _context.next = 8;\n                  return _auth2.default.federatedSignIn('google', {\n                    token: id_token,\n                    expires_at: expires_at\n                  }, user);\n\n                case 8:\n                  _context.next = 10;\n                  return _auth2.default.currentAuthenticatedUser();\n\n                case 10:\n                  user = _context.sent;\n\n                  if (onStateChange) {\n                    onStateChange('signedIn', user);\n                  }\n\n                case 12:\n                case 'end':\n                  return _context.stop();\n              }\n            }\n          }, _callee, this);\n        }));\n\n        function federatedSignIn(_x) {\n          return _ref.apply(this, arguments);\n        }\n\n        return federatedSignIn;\n      }()\n    }, {\n      key: 'componentDidMount',\n      value: function componentDidMount() {\n        var google_client_id = this.props.google_client_id;\n        if (google_client_id) this.createScript();\n      }\n    }, {\n      key: 'createScript',\n      value: function createScript() {\n        var script = document.createElement('script');\n        script.src = 'https://apis.google.com/js/platform.js';\n        script.async = true;\n        script.onload = this.initGapi;\n        document.body.appendChild(script);\n      }\n    }, {\n      key: 'initGapi',\n      value: function initGapi() {\n        logger.debug('init gapi');\n        var that = this;\n        var google_client_id = this.props.google_client_id;\n        var g = window.gapi;\n        g.load('auth2', function () {\n          g.auth2.init({\n            client_id: google_client_id,\n            scope: 'profile email openid'\n          });\n        });\n      }\n    }, {\n      key: 'render',\n      value: function render() {\n        var ga = window.gapi && window.gapi.auth2 ? window.gapi.auth2.getAuthInstance() : null;\n        return _react2.default.createElement(Comp, (0, _extends3.default)({}, this.props, {\n          ga: ga,\n          googleSignIn: this.signIn\n        }));\n      }\n    }]);\n    return _class;\n  }(_react.Component);\n}\n\nvar Button = function Button(props) {\n  return _react2.default.createElement(_AmplifyUIComponentsReact.SignInButton, {\n    id: _ui.googleSignInButton,\n    onClick: props.googleSignIn,\n    theme: props.theme || _AmplifyUITheme2.default,\n    variant: 'googleSignInButton'\n  }, _react2.default.createElement(_AmplifyUIComponentsReact.SignInButtonIcon, {\n    theme: props.theme || _AmplifyUITheme2.default\n  }, _react2.default.createElement('svg', {\n    viewBox: '0 0 256 262',\n    xmlns: 'http://ww0w.w3.org/2000/svg',\n    preserveAspectRatio: 'xMidYMid'\n  }, _react2.default.createElement('path', {\n    d: 'M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027',\n    fill: '#4285F4'\n  }), _react2.default.createElement('path', {\n    d: 'M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1',\n    fill: '#34A853'\n  }), _react2.default.createElement('path', {\n    d: 'M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782',\n    fill: '#FBBC05'\n  }), _react2.default.createElement('path', {\n    d: 'M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251',\n    fill: '#EB4335'\n  }))), _react2.default.createElement(_AmplifyUIComponentsReact.SignInButtonContent, {\n    theme: props.theme || _AmplifyUITheme2.default\n  }, _core.I18n.get('Sign In with Google')));\n};\n\nvar GoogleButton = exports.GoogleButton = withGoogle(Button);","map":null,"metadata":{},"sourceType":"script"}