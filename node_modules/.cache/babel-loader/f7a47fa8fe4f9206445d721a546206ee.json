{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _Greetings = require('./Greetings');\n\nvar _Greetings2 = _interopRequireDefault(_Greetings);\n\nvar _SignIn = require('./SignIn');\n\nvar _SignIn2 = _interopRequireDefault(_SignIn);\n\nvar _ConfirmSignIn = require('./ConfirmSignIn');\n\nvar _ConfirmSignIn2 = _interopRequireDefault(_ConfirmSignIn);\n\nvar _RequireNewPassword = require('./RequireNewPassword');\n\nvar _RequireNewPassword2 = _interopRequireDefault(_RequireNewPassword);\n\nvar _SignUp = require('./SignUp');\n\nvar _SignUp2 = _interopRequireDefault(_SignUp);\n\nvar _ConfirmSignUp = require('./ConfirmSignUp');\n\nvar _ConfirmSignUp2 = _interopRequireDefault(_ConfirmSignUp);\n\nvar _VerifyContact = require('./VerifyContact');\n\nvar _VerifyContact2 = _interopRequireDefault(_VerifyContact);\n\nvar _ForgotPassword = require('./ForgotPassword');\n\nvar _ForgotPassword2 = _interopRequireDefault(_ForgotPassword);\n\nvar _TOTPSetup = require('./TOTPSetup');\n\nvar _TOTPSetup2 = _interopRequireDefault(_TOTPSetup);\n\nvar _AmplifyUITheme = require('../Amplify-UI/Amplify-UI-Theme');\n\nvar _AmplifyUITheme2 = _interopRequireDefault(_AmplifyUITheme);\n\nvar _AmplifyMessageMap = require('../AmplifyMessageMap');\n\nvar _AmplifyMessageMap2 = _interopRequireDefault(_AmplifyMessageMap);\n\nvar _AmplifyUIComponentsReact = require('../Amplify-UI/Amplify-UI-Components-React');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar logger = new _core.ConsoleLogger('Authenticator');\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nvar Authenticator = function (_Component) {\n  (0, _inherits3.default)(Authenticator, _Component);\n\n  function Authenticator(props) {\n    (0, _classCallCheck3.default)(this, Authenticator);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (Authenticator.__proto__ || Object.getPrototypeOf(Authenticator)).call(this, props));\n\n    _this.handleStateChange = _this.handleStateChange.bind(_this);\n    _this.handleAuthEvent = _this.handleAuthEvent.bind(_this);\n    _this.onHubCapsule = _this.onHubCapsule.bind(_this);\n    _this.state = {\n      auth: props.authState || 'loading'\n    };\n\n    _core.Hub.listen('auth', _this);\n\n    return _this;\n  }\n\n  (0, _createClass3.default)(Authenticator, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var config = this.props.amplifyConfig;\n\n      if (config) {\n        _core2.default.configure(config);\n      }\n\n      this._isMounted = true;\n      this.checkUser();\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n    }\n  }, {\n    key: 'checkUser',\n    value: function checkUser() {\n      var _this2 = this;\n\n      var auth = this.state.auth;\n\n      if (!_auth2.default || typeof _auth2.default.currentAuthenticatedUser !== 'function') {\n        throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n      }\n\n      return _auth2.default.currentAuthenticatedUser().then(function (user) {\n        if (!_this2._isMounted) {\n          return;\n        }\n\n        if (auth !== 'signedIn') {\n          _this2.setState({\n            authState: 'signedIn',\n            authData: user\n          });\n\n          _this2.handleStateChange('signedIn', user);\n        }\n      }).catch(function (err) {\n        if (!_this2._isMounted) {\n          return;\n        }\n\n        _auth2.default.signOut().then(function () {\n          return _this2.handleStateChange('signedOut');\n        });\n      });\n    }\n  }, {\n    key: 'onHubCapsule',\n    value: function onHubCapsule(capsule) {\n      var channel = capsule.channel,\n          payload = capsule.payload,\n          source = capsule.source;\n\n      if (channel === 'auth' && (payload.event === 'configured' || payload.event === 'cognitoHostedUI')) {\n        this.checkUser();\n      }\n    }\n  }, {\n    key: 'handleStateChange',\n    value: function handleStateChange(state, data) {\n      logger.debug('authenticator state change ' + state, data);\n\n      if (state === this.state.auth) {\n        return;\n      }\n\n      if (state === 'signedOut') {\n        state = 'signIn';\n      }\n\n      this.setState({\n        auth: state,\n        authData: data,\n        error: null\n      });\n\n      if (this.props.onStateChange) {\n        this.props.onStateChange(state, data);\n      }\n    }\n  }, {\n    key: 'handleAuthEvent',\n    value: function handleAuthEvent(state, event) {\n      if (event.type === 'error') {\n        var map = this.props.errorMessage || _AmplifyMessageMap2.default;\n        var message = typeof map === 'string' ? map : map(event.data);\n        this.setState({\n          error: message,\n          showToast: true\n        });\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this3 = this;\n\n      var _state = this.state,\n          auth = _state.auth,\n          authData = _state.authData;\n      var theme = this.props.theme || _AmplifyUITheme2.default;\n      var messageMap = this.props.errorMessage || _AmplifyMessageMap2.default;\n      var _props = this.props,\n          hideDefault = _props.hideDefault,\n          _props$hide = _props.hide,\n          hide = _props$hide === undefined ? [] : _props$hide,\n          federated = _props.federated;\n\n      if (hideDefault) {\n        hide = hide.concat([_Greetings2.default, _SignIn2.default, _ConfirmSignIn2.default, _RequireNewPassword2.default, _SignUp2.default, _ConfirmSignUp2.default, _VerifyContact2.default, _ForgotPassword2.default, _TOTPSetup2.default]);\n      }\n\n      var props_children = this.props.children || [];\n      var default_children = [_react2.default.createElement(_Greetings2.default, null), _react2.default.createElement(_SignIn2.default, {\n        federated: federated\n      }), _react2.default.createElement(_ConfirmSignIn2.default, null), _react2.default.createElement(_RequireNewPassword2.default, null), _react2.default.createElement(_SignUp2.default, null), _react2.default.createElement(_ConfirmSignUp2.default, null), _react2.default.createElement(_VerifyContact2.default, null), _react2.default.createElement(_ForgotPassword2.default, null), _react2.default.createElement(_TOTPSetup2.default, null)];\n\n      var props_children_names = _react2.default.Children.map(props_children, function (child) {\n        return child.type.name;\n      });\n\n      hide = hide.filter(function (component) {\n        return !props_children_names.includes(component.name);\n      });\n\n      var render_props_children = _react2.default.Children.map(props_children, function (child, index) {\n        return _react2.default.cloneElement(child, {\n          key: 'aws-amplify-authenticator-props-children-' + index,\n          theme: theme,\n          messageMap: messageMap,\n          authState: auth,\n          authData: authData,\n          onStateChange: _this3.handleStateChange,\n          onAuthEvent: _this3.handleAuthEvent,\n          hide: hide\n        });\n      });\n\n      var render_default_children = hideDefault ? [] : _react2.default.Children.map(default_children, function (child, index) {\n        return _react2.default.cloneElement(child, {\n          key: 'aws-amplify-authenticator-default-children-' + index,\n          theme: theme,\n          messageMap: messageMap,\n          authState: auth,\n          authData: authData,\n          onStateChange: _this3.handleStateChange,\n          onAuthEvent: _this3.handleAuthEvent,\n          hide: hide\n        });\n      });\n      var render_children = render_default_children.concat(render_props_children);\n      var error = this.state.error;\n      return _react2.default.createElement(_AmplifyUIComponentsReact.Container, {\n        theme: theme\n      }, this.state.showToast && _react2.default.createElement(_AmplifyUIComponentsReact.Toast, {\n        onClose: function onClose() {\n          return _this3.setState({\n            showToast: false\n          });\n        }\n      }, _core.I18n.get(error)), render_children);\n    }\n  }]);\n  return Authenticator;\n}(_react.Component);\n\nexports.default = Authenticator;","map":null,"metadata":{},"sourceType":"script"}