{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _core = require('@aws-amplify/core');\n\nvar _auth = require('@aws-amplify/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _AmplifyUITheme = require('../Amplify-UI/Amplify-UI-Theme');\n\nvar _AmplifyUITheme2 = _interopRequireDefault(_AmplifyUITheme);\n\nvar _AmplifyUIComponentsReact = require('../Amplify-UI/Amplify-UI-Components-React');\n\nvar _TOTPSetupComp = require('./TOTPSetupComp');\n\nvar _TOTPSetupComp2 = _interopRequireDefault(_TOTPSetupComp);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\n\nvar logger = new _core.ConsoleLogger('SelectMFAType');\n\nvar SelectMFAType = function (_Component) {\n  (0, _inherits3.default)(SelectMFAType, _Component);\n\n  function SelectMFAType(props) {\n    (0, _classCallCheck3.default)(this, SelectMFAType);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, (SelectMFAType.__proto__ || Object.getPrototypeOf(SelectMFAType)).call(this, props));\n\n    _this.verify = _this.verify.bind(_this);\n    _this.handleInputChange = _this.handleInputChange.bind(_this);\n    _this.state = {\n      TOTPSetup: false,\n      selectMessage: null\n    };\n    return _this;\n  }\n\n  (0, _createClass3.default)(SelectMFAType, [{\n    key: 'handleInputChange',\n    value: function handleInputChange(evt) {\n      // clear current state\n      this.setState({\n        TOTPSetup: false,\n        selectMessage: null\n      });\n      this.inputs = {};\n      var _evt$target = evt.target,\n          name = _evt$target.name,\n          value = _evt$target.value,\n          type = _evt$target.type,\n          checked = _evt$target.checked;\n      var check_type = ['radio', 'checkbox'].includes(type);\n      this.inputs[value] = check_type ? checked : value;\n    }\n  }, {\n    key: 'verify',\n    value: function verify() {\n      var _this2 = this;\n\n      logger.debug('mfatypes inputs', this.inputs);\n\n      if (!this.inputs) {\n        logger.debug('No mfa type selected');\n        return;\n      }\n\n      var _inputs = this.inputs,\n          TOTP = _inputs.TOTP,\n          SMS = _inputs.SMS,\n          NOMFA = _inputs.NOMFA;\n      var mfaMethod = null;\n\n      if (TOTP) {\n        mfaMethod = 'TOTP';\n      } else if (SMS) {\n        mfaMethod = 'SMS';\n      } else if (NOMFA) {\n        mfaMethod = 'NOMFA';\n      }\n\n      var user = this.props.authData;\n\n      if (!_auth2.default || typeof _auth2.default.setPreferredMFA !== 'function') {\n        throw new Error('No Auth module found, please ensure @aws-amplify/auth is imported');\n      }\n\n      _auth2.default.setPreferredMFA(user, mfaMethod).then(function (data) {\n        logger.debug('set preferred mfa success', data);\n\n        _this2.setState({\n          selectMessage: 'Success! Your MFA Type is now: ' + mfaMethod,\n          showToast: true\n        });\n      }).catch(function (err) {\n        var message = err.message;\n\n        if (message === 'User has not set up software token mfa' || message === 'User has not verified software token mfa') {\n          _this2.setState({\n            TOTPSetup: true,\n            selectMessage: 'You need to setup TOTP',\n            showToast: true\n          });\n        } else {\n          logger.debug('set preferred mfa failed', err);\n\n          _this2.setState({\n            selectMessage: 'Failed! You cannot select MFA Type for now!',\n            showToast: true\n          });\n        }\n      });\n    }\n  }, {\n    key: 'selectView',\n    value: function selectView(theme) {\n      var _this3 = this;\n\n      var MFATypes = this.props.MFATypes;\n\n      if (!MFATypes || Object.keys(MFATypes).length < 2) {\n        logger.debug('less than 2 mfa types available');\n        return _react2.default.createElement('div', null, _react2.default.createElement('a', null, 'less than 2 mfa types available'));\n      }\n\n      var SMS = MFATypes.SMS,\n          TOTP = MFATypes.TOTP,\n          Optional = MFATypes.Optional;\n      return _react2.default.createElement(_AmplifyUIComponentsReact.FormSection, {\n        theme: theme\n      }, this.state.showToast && this.state.selectMessage && _react2.default.createElement(_AmplifyUIComponentsReact.Toast, {\n        onClose: function onClose() {\n          return _this3.setState({\n            showToast: false\n          });\n        }\n      }, _core.I18n.get(this.state.selectMessage)), _react2.default.createElement(_AmplifyUIComponentsReact.SectionHeader, {\n        theme: theme\n      }, _core.I18n.get('Select MFA Type')), _react2.default.createElement(_AmplifyUIComponentsReact.SectionBody, {\n        theme: theme\n      }, _react2.default.createElement('div', null, SMS ? _react2.default.createElement(_AmplifyUIComponentsReact.RadioRow, {\n        placeholder: _core.I18n.get('SMS'),\n        theme: theme,\n        key: 'sms',\n        name: 'MFAType',\n        value: 'SMS',\n        onChange: this.handleInputChange\n      }) : null, TOTP ? _react2.default.createElement(_AmplifyUIComponentsReact.RadioRow, {\n        placeholder: _core.I18n.get('TOTP'),\n        theme: theme,\n        key: 'totp',\n        name: 'MFAType',\n        value: 'TOTP',\n        onChange: this.handleInputChange\n      }) : null, Optional ? _react2.default.createElement(_AmplifyUIComponentsReact.RadioRow, {\n        placeholder: _core.I18n.get('No MFA'),\n        theme: theme,\n        key: 'noMFA',\n        name: 'MFAType',\n        value: 'NOMFA',\n        onChange: this.handleInputChange\n      }) : null)), _react2.default.createElement(_AmplifyUIComponentsReact.SectionFooter, null, _react2.default.createElement(_AmplifyUIComponentsReact.Button, {\n        theme: theme,\n        onClick: this.verify\n      }, _core.I18n.get('Verify'))));\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var theme = this.props.theme ? theme : _AmplifyUITheme2.default;\n      return _react2.default.createElement('div', null, this.selectView(theme), this.state.TOTPSetup ? _react2.default.createElement(_TOTPSetupComp2.default, this.props) : null);\n    }\n  }]);\n  return SelectMFAType;\n}(_react.Component);\n\nexports.default = SelectMFAType;","map":null,"metadata":{},"sourceType":"script"}